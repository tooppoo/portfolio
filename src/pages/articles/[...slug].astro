---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import RightArrow from "../../components/icon/RightArrow.astro";

export async function getStaticPaths() {
  const armoredcoreArticles = await getCollection("armoredcore");
  const techArticles = await getCollection("tech");
  const philosophyArticles = await getCollection("philosophy");
  const noteArticles = await getCollection("note");
  const allArticles = [...armoredcoreArticles, ...techArticles, ...philosophyArticles, ...noteArticles];

  return allArticles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

interface Props {
  article: CollectionEntry<"armoredcore"> | CollectionEntry<"tech"> | CollectionEntry<"philosophy"> | CollectionEntry<"note">;
}

const { article } = Astro.props;
const { Content } = await article.render();

const { title, description, publishDate, category, tags } = article.data;

// Generate page title and description for SEO
const pageTitle = `${title} - Philomagi.dev`;
const pageDescription = description;
const articleUrl = new URL(`/articles/${article.slug}`, Astro.site);
const twitterShareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(articleUrl.toString())}&via=philomagi`;
---

<Layout title={pageTitle} description={pageDescription} type="article">
  <div class="space-y-8">
    <!-- Article Header -->
    <header class="space-y-6 text-center border-b border-gray-800 pb-8">
      <!-- Breadcrumb -->
      <nav class="text-sm">
        <ol class="list-none flex items-center justify-center space-x-2 text-gray-400">
          <li>
            <a href="/" class="hover:text-white transition-colors">Home</a>
          </li>
          <li>
            <RightArrow />
          </li>
          <li>
            <a href="/articles" class="hover:text-white transition-colors"
              >Articles</a
            >
          </li>
          <li>
            <RightArrow />
          </li>
          <li class="text-white font-medium">{title}</li>
        </ol>
      </nav>

      <!-- Article Metadata -->
      <div class="space-y-4">
        <div class="flex flex-wrap gap-2 items-center justify-center">
          <span
            class="px-3 py-1 bg-cyan-500/10 text-cyan-400 rounded-full border border-cyan-500/20 text-sm"
          >
            {category}
          </span>
          <time
            datetime={publishDate.toISOString()}
            class="text-gray-400 text-sm"
          >
            {
              publishDate.toLocaleDateString("ja-JP", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>
        </div>

        <!-- Tags -->
        {
          tags && tags.length > 0 && (
            <div class="flex flex-wrap gap-2 justify-center">
              {tags.map((tag) => (
                <span class="px-2 py-1 text-sm bg-gray-800 text-gray-300 rounded border border-gray-700">
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
      </div>

      <!-- Article Title -->
      <h1
        class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent leading-tight"
      >
        {title}
      </h1>

      <!-- Article Description -->
      <p class="text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed">
        {description}
      </p>
    </header>

    <!-- Article Content -->
    <article class="prose prose-invert prose-primary max-w-none">
      <Content />
    </article>

    <!-- Article Footer -->
    <footer class="border-t border-gray-800 pt-8 space-y-6">
      <!-- Navigation -->
      <div class="flex flex-col sm:flex-row gap-4 justify-between items-start">
        <a
          href="/articles"
          class="inline-flex items-center text-gray-400 hover:text-white transition-colors group"
        >
          <svg
            class="mr-2 w-4 h-4 transition-transform group-hover:-translate-x-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"></path>
          </svg>
          記事一覧に戻る
        </a>

        <a
          href="/"
          class="inline-flex items-center text-gray-400 hover:text-white transition-colors"
        >
          ホームに戻る
          <svg
            class="ml-2 w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>

      <!-- Share/Contact Section -->
      <div
        class="text-center p-6 bg-gray-800/50 rounded-lg border border-gray-700"
      >
        <div class="flex justify-center space-x-4">
          <a
            href={twitterShareUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center px-4 py-2 bg-cyan-500/10 text-cyan-400 rounded-lg border border-cyan-500/20 hover:bg-cyan-500/20 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"
              ></path>
            </svg>
            X（Twitter）で共有
          </a>
        </div>
      </div>
    </footer>
  </div>
</Layout>

<style>
  /* Enhanced table styles for markdown content */
  article :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    border: 1px solid rgb(55 65 81);
    border-radius: 0.5rem;
    overflow: hidden;
  }

  article :global(th),
  article :global(td) {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid rgb(55 65 81);
  }

  article :global(th) {
    background-color: rgb(31 41 55);
    font-weight: 600;
    color: rgb(0 217 255);
  }

  article :global(td) {
    background-color: rgb(17 24 39);
  }

  article :global(tr:hover td) {
    background-color: rgb(31 41 55);
  }

  article :global(th:first-child),
  article :global(td:first-child) {
    border-left: none;
  }

  article :global(th:last-child),
  article :global(td:last-child) {
    border-right: none;
  }

  article :global(tr:last-child td) {
    border-bottom: none;
  }

  /* Enhanced link styles within tables */
  article :global(td a) {
    color: rgb(0 217 255);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  article :global(td a:hover) {
    color: rgb(77 234 255);
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
  }

  /* Footnote references: add spacing when multiple are adjacent */
  article :global(sup + sup) {
    margin-left: 0.3em;
  }

</style>
