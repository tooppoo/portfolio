---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import ArticleSearch from '../components/search/ArticleSearch';

// Get all articles from all collections
const armoredcoreArticles = await getCollection('armoredcore');
const techArticles = await getCollection('tech');
const philosophyArticles = await getCollection('philosophy');
const noteArticles = await getCollection('note');

// Combine all articles
const allArticles = ((isProd: boolean) => {
  const whole = [...armoredcoreArticles, ...techArticles, ...philosophyArticles, ...noteArticles]
  const filter = isProd
    ? (article: typeof whole[number]) => !article.data.draft
    : () => true;

  return whole.filter(filter);
})(import.meta.env.MODE === "production")

// Sort articles by publish date (newest first)
const sortedArticles = allArticles.sort(
  (a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

// Prepare articles data for SolidJS component
const articlesData = sortedArticles.map(article => ({
  slug: article.slug,
  title: article.data.title,
  description: article.data.description,
  publishDate: article.data.publishDate.toISOString(),
  category: article.data.category,
  tags: article.data.tags || []
}));

const pageTitle = 'Articles - Philomagi.dev';
const pageDescription = 'ゲーム、技術、哲学に関する記事一覧。主にアーマードコア6やプログラミングについて書いています。';
---

<Layout
  title={pageTitle}
  description={pageDescription}
  type="website"
>
  <div class="space-y-12">
    <!-- Page Header -->
    <header class="text-center space-y-4">
      <h1 class="text-5xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
        Articles
      </h1>
      <p class="text-xl text-gray-300 max-w-2xl mx-auto">
        ゲーム、技術、哲学に関する記事を書いています。
      </p>
    </header>

    <!-- Article Search with SolidJS -->
    <ArticleSearch articles={articlesData} client:load />

    <!-- Back to Home -->
    <div class="text-center pt-8">
      <a
        href="/"
        class="inline-flex items-center text-gray-400 hover:text-white transition-colors"
      >
        <svg
          class="mr-2 w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        ホームに戻る
      </a>
    </div>
  </div>
</Layout>